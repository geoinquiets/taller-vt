



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>4. Cómo crearlas - Trabajando con VT</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#como-crear-teselas-vectoriales" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Trabajando con VT" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Trabajando con VT
              </span>
              <span class="md-header-nav__topic">
                4. Cómo crearlas
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/geoinquiets/taller-vt/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Trabajando con VT
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/geoinquiets/taller-vt/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_teoria/" title="1. Qué son" class="md-nav__link">
      1. Qué son
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2_visor_simple/" title="2. Cómo visualizarlas" class="md-nav__link">
      2. Cómo visualizarlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3_tileserver_gl/" title="3. Cómo servirlas" class="md-nav__link">
      3. Cómo servirlas
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        4. Cómo crearlas
      </label>
    
    <a href="./" title="4. Cómo crearlas" class="md-nav__link md-nav__link--active">
      4. Cómo crearlas
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#los-datos-de-natural-earth" title="Los datos de Natural Earth" class="md-nav__link">
    Los datos de Natural Earth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tippecanoe" title="Tippecanoe" class="md-nav__link">
    Tippecanoe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-el-fichero-mbtiles" title="Creando el fichero mbtiles" class="md-nav__link">
    Creando el fichero mbtiles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicando-el-mbtiles" title="Publicando el mbtiles" class="md-nav__link">
    Publicando el mbtiles
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_sprites_glyphs/" title="5. Sprites y Glyphs" class="md-nav__link">
      5. Sprites y Glyphs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6_estilos/" title="6. Cómo simbolizarlas" class="md-nav__link">
      6. Cómo simbolizarlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_servidor_dinamico/" title="7. Cómo servir datos dinámicos" class="md-nav__link">
      7. Cómo servir datos dinámicos
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#los-datos-de-natural-earth" title="Los datos de Natural Earth" class="md-nav__link">
    Los datos de Natural Earth
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tippecanoe" title="Tippecanoe" class="md-nav__link">
    Tippecanoe
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creando-el-fichero-mbtiles" title="Creando el fichero mbtiles" class="md-nav__link">
    Creando el fichero mbtiles
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicando-el-mbtiles" title="Publicando el mbtiles" class="md-nav__link">
    Publicando el mbtiles
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/geoinquiets/taller-vt/edit/master/docs/4_tippecanoe.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="como-crear-teselas-vectoriales">Cómo crear teselas vectoriales</h1>
<h2 id="los-datos-de-natural-earth">Los datos de Natural Earth</h2>
<p>En el apartado de descargas de <a href="http://www.naturalearthdata.com/">Natural Earth</a> hay varios conjuntos de datos
en formato Shapefile, según la escala. En el taller trabajaremos con un subconjunto de los datos de la escala 1:10M
(1:10.000.000). Para ahorrarnos la transformación de Shapefile a GeoJSON, utilizaremos los datos procedentes de
<a href="https://github.com/nvkelso/natural-earth-vector/tree/master/geojson"><a href="https://github.com/nvkelso/natural-earth-vector/">https://github.com/nvkelso/natural-earth-vector/</a></a>.</p>
<p>En concreto usaremos las siguientes capas:</p>
<ul>
<li>Cultural<ul>
<li>Admin 0 – Countries (247 países en el mundo. Groenlandia separada de Dinamarca)</li>
<li>Populated Places (Puntos de ciudades y pueblos)</li>
<li>Roads (Carreteras principales)</li>
<li>Railroads (Vías de Trenes)</li>
<li>Airports (Aeropuertos)</li>
</ul>
</li>
<li>Physical<ul>
<li>Coastline (Línea de costa que incluyen islas principales)</li>
<li>Land (Polígonos terrestres que incluyen islas principales)</li>
<li>Ocean (Oceano)</li>
<li>Rivers + lake centerlines (Rios en única línea que incluyen líneas centrales de lagos)</li>
<li>Lakes + Reservoirs (Lagos naturales y artificiales)</li>
</ul>
</li>
</ul>
<p>Nosotros descargaremos las 10 capas de un zip y las descomprimiremos en <code>taller-vt/datos/naturalearth</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">cd</span> ~/Desktop/taller-vt/datos
wget https://geoinquiets.github.io/taller-vt/downloads/naturalearth.zip
unzip naturalearth.zip 
</pre></div>
</td></tr></table>

<h2 id="tippecanoe">Tippecanoe</h2>
<p><a href="https://github.com/mapbox/tippecanoe">Tippecanoe</a> es la herramienta que permite crear teselas vectoriales de
grandes colecciones de elementos en formato GeoJSON.</p>
<p>El objetivo de Tippecanoe es permitir una visión de sus datos independiente de la escala, de modo que en cualquier
nivel, desde el mundo entero hasta un solo edificio, se pueda apreciar la densidad y la textura de los datos, en
lugar de una simplificación geométrica, que puede eliminar vértices importantes que cambien la apariencia de los datos
en su versión simplificada.</p>
<p>Algunos ejemplos:</p>
<ul>
<li>Teniendo todo el callejero de OpenStreetMap, la vista general devolverá algo que se parece a
"Todas las calles" en lugar de algo que parece un atlas de carreteras interestatal.</li>
<li>Teniendo todas las plantas de edificios de una ciudad, en la vista general donde los edificios individuales ya no
sean perceptibles, aún deberías poder ver la extensión y variedad del desarrollo en cada vecindario,
no solo para los edificios más voluminosos.</li>
</ul>
<p>Esto hace que la calidad de los resultados de Tippecanoe sea muy superior a otras alternativas, que utilizan algoritmos
de simplificación más convencionales, motivo por el cual lo recomendamos en este taller.</p>
<p>Además, es sorprendentemente rápido procesando los datos.</p>
<h2 id="creando-el-fichero-mbtiles">Creando el fichero mbtiles</h2>
<p>Vamos a crear un fichero mbtiles llamado <em>natural_earth.mbtiles</em> que contendrá nuestras 10 capas. </p>
<p>Para crear el mbtiles utilizaremos las siguientes <a href="https://github.com/mapbox/tippecanoe#options">opciones del Tippecanoe</a>:</p>
<ul>
<li><code>-o nombre.mbtiles</code>: nombre del archivo de salida.</li>
<li><code>-zg</code>: Estima un maxzoom razonable basado en la resolución de los datos.</li>
<li><code>--drop-densest-as-needed</code>: Si una tesela es demasiado pesada, intenta reducirla a menos de 500 KB reduciendo su detalle.</li>
<li><code>-L nombre:archivo.json</code>: permite definir nombres de capa para cada archivo individual.</li>
</ul>
<p>Para generar el archivo mbtiles escribiremos lo siguiente en el terminal:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">cd</span> naturalearth
tippecanoe -o natural_earth.mbtiles -zg --drop-densest-as-needed <span class="se">\</span>
  -L ocean:ne_10m_ocean.geojson <span class="se">\</span>
  -L land:ne_10m_land.geojson <span class="se">\</span>
  -L admin:ne_10m_admin_0_countries.geojson <span class="se">\</span>
  -L coastline:ne_10m_coastline.geojson <span class="se">\</span>
  -L lakes:ne_10m_lakes.geojson <span class="se">\</span>
  -L rivers:ne_10m_rivers_lake_centerlines.geojson <span class="se">\</span>
  -L rail:ne_10m_railroads.geojson <span class="se">\</span>
  -L roads:ne_10m_roads.geojson <span class="se">\</span>
  -L cities:ne_10m_populated_places.geojson <span class="se">\</span>
  -L airports:ne_10m_airports.geojson
</pre></div>
</td></tr></table>

<h2 id="publicando-el-mbtiles">Publicando el mbtiles</h2>
<p>Añadiremos el mbtiles a <code>Tileserver GL</code> igual que hicimos con los edificios de Barcelona:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mv natural_earth.mbtiles ../../tileserver/data
cd ../../tileserver
</pre></div>
</td></tr></table>

<p>Editamos <code>config.json</code> y añadimos la nueva capa:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="err">...</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;v3&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;barcelona.mbtiles&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;buildings&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings.mbtiles&quot;</span>
    <span class="p">},</span>
<span class="hll">    <span class="nt">&quot;natural_earth&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;natural_earth.mbtiles&quot;</span>
</span><span class="hll">    <span class="p">}</span>
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Tras parar y arrancar el <code>tileserver</code> de nuevo, abrir el navegador y escribir <a href="http://localhost:8081">http://localhost:8081</a> y comprobar que
aparece la página del TileServer con nuestro mbtiles:</p>
<p><img alt="TileServer GL Light" src="../img/mbtiles_tippecanoe.png" /></p>
<p>Hacer click en el botón de <strong>Inspect</strong> y comprobar que en el mapa aparecen todas las capas agregadas al mbtiles:</p>
<p><img alt="Mbtiles Natural Earth" src="../img/natural_earth_mbtiles.png" /></p>
<p>Así pues, una tesela vectorial contiene varias "capas" internamente. En una regla de simbolización, deberá indicarse
tanto origen de datos (<code>"source": "natural_earth"</code>), como la capa dentro de la tesela (<code>"source_layer": "roads"</code>).</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../3_tileserver_gl/" title="3. Cómo servirlas" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                3. Cómo servirlas
              </span>
            </div>
          </a>
        
        
          <a href="../5_sprites_glyphs/" title="5. Sprites y Glyphs" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                5. Sprites y Glyphs
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b438e6c5.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>