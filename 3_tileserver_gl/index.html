



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>3. Cómo servirlas - Trabajando con VT</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#como-servir-teselas-vectoriales" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Trabajando con VT" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Trabajando con VT
              </span>
              <span class="md-header-nav__topic">
                3. Cómo servirlas
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/geoinquiets/taller-vt/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Trabajando con VT
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/geoinquiets/taller-vt/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_teoria/" title="1. Qué son" class="md-nav__link">
      1. Qué son
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2_visor_simple/" title="2. Cómo visualizarlas" class="md-nav__link">
      2. Cómo visualizarlas
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        3. Cómo servirlas
      </label>
    
    <a href="./" title="3. Cómo servirlas" class="md-nav__link md-nav__link--active">
      3. Cómo servirlas
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-tileserver-gl" title="Instalación de TileServer GL" class="md-nav__link">
    Instalación de TileServer GL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arranque-con-la-configuracion-por-defecto" title="Arranque con la configuración por defecto" class="md-nav__link">
    Arranque con la configuración por defecto
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtener-datos-de-barcelona" title="Obtener datos de Barcelona" class="md-nav__link">
    Obtener datos de Barcelona
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-visor-de-mapas" title="Modificar el visor de mapas" class="md-nav__link">
    Modificar el visor de mapas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-completa" title="Configuración completa" class="md-nav__link">
    Configuración completa
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-datos-de-edificios" title="Añadiendo datos de edificios" class="md-nav__link">
    Añadiendo datos de edificios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-los-nuevos-datos-al-visor" title="Añadiendo los nuevos datos al visor" class="md-nav__link">
    Añadiendo los nuevos datos al visor
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../4_tippecanoe/" title="4. Cómo crearlas" class="md-nav__link">
      4. Cómo crearlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_sprites_glyphs/" title="5. Sprites y Glyphs" class="md-nav__link">
      5. Sprites y Glyphs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6_estilos/" title="6. Cómo simbolizarlas" class="md-nav__link">
      6. Cómo simbolizarlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_servidor_dinamico/" title="7. Cómo servir datos dinámicos" class="md-nav__link">
      7. Cómo servir datos dinámicos
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalacion-de-tileserver-gl" title="Instalación de TileServer GL" class="md-nav__link">
    Instalación de TileServer GL
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#arranque-con-la-configuracion-por-defecto" title="Arranque con la configuración por defecto" class="md-nav__link">
    Arranque con la configuración por defecto
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtener-datos-de-barcelona" title="Obtener datos de Barcelona" class="md-nav__link">
    Obtener datos de Barcelona
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-visor-de-mapas" title="Modificar el visor de mapas" class="md-nav__link">
    Modificar el visor de mapas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuracion-completa" title="Configuración completa" class="md-nav__link">
    Configuración completa
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-datos-de-edificios" title="Añadiendo datos de edificios" class="md-nav__link">
    Añadiendo datos de edificios
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anadiendo-los-nuevos-datos-al-visor" title="Añadiendo los nuevos datos al visor" class="md-nav__link">
    Añadiendo los nuevos datos al visor
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/geoinquiets/taller-vt/edit/master/docs/3_tileserver_gl.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="como-servir-teselas-vectoriales">Cómo servir teselas vectoriales</h1>
<h2 id="instalacion-de-tileserver-gl">Instalación de TileServer GL</h2>
<p><a href="http://tileserver.org/">TileServer GL</a> es un servidor de mapas de código abierto creado para teselas vectoriales, y
capaz de renderizar en teselas raster con MapBox GL Native engine en el lado del servidor.</p>
<p>Proporciona mapas para aplicaciones web y móviles. Es compatibles con Mapbox GL JS, Android SDK, iOS SDK, Leaflet,
OpenLayers, HighDPI/Retina, SIG a través de WMTS, etc.</p>
<p>Si se quiere servir teselas raster lo mejor es utilizar la versión de Docker ya que son necesarias algunas librerías
nativas que pueden variar dependiendo de la plataforma, estas librerías sirven para renderizar las teselas vectoriales
en teselas raster. Si únicamente se quiere servir teselas vectoriales se puede utilizar el TileServer GL Light,
que no tiene ninguna dependencia nativa ya que está desarrollado en javascript.</p>
<p>Para este taller utilizaremos la versión Light ya que serviremos sólo teselas vectoriales.</p>
<p>Es necesario tener instalado <a href="https://nodejs.org/es/">Node.js</a> versión 6.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>tileserver-gl-light NO se instalará correctamente si estamos usando una versión de Node.js superior a la 6.
Debemos activar esta versión de node con el comando:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>nvm use <span class="m">6</span>
node -v <span class="c1"># Debería devolver: 6.x.x</span>
</pre></div>
</td></tr></table>

</div>
<p>Una vez comprobada la versión de node:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>npm install -g tileserver-gl-light@2.3.1
tileserver-gl-light -v <span class="c1"># Deberia devolver: v2.3.1 </span>
</pre></div>
</td></tr></table>

<h2 id="arranque-con-la-configuracion-por-defecto">Arranque con la configuración por defecto</h2>
<h3 id="obtener-datos-de-barcelona">Obtener datos de Barcelona</h3>
<p>Crear una carpeta llamada <code>tileserver/data</code> y copiar en ella el fichero `datos/barcelona.mbtiles:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">cd</span> ~/Desktop/taller-vt
mkdir -p tileserver/data
cp datos/barcelona.mbtiles tileserver/data
</pre></div>
</td></tr></table>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>En la web de <a href="https://openmaptiles.com/downloads">OpenMapTiles</a> se pueden descargar datos de muchas
otras ciudades, países, e incluso el planeta entero. Es gratuíto, aunque hay que registrarse y los datos
no están del todo actualizados. </p>
</div>
<p>Ahora arrancaremos el servidor en el puerto <code>8081</code> (parámetro <code>-p</code>):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">cd</span> tileserver
tileserver-gl-light data/barcelona.mbtiles -p <span class="m">8081</span>
</pre></div>
</td></tr></table>

<p>Abrir el navegador y escribir <a href="http://localhost:8081">http://localhost:8081</a>. Aparecerá la página del TileServer.</p>
<p>Dejar el terminal abierto con el servidor arrancado.</p>
<p><img alt="TileServer GL Light" src="../img/tileServerGL.png" />
<em>TileServer GL Light</em></p>
<h3 id="modificar-el-visor-de-mapas">Modificar el visor de mapas</h3>
<p>Modificaremos nuestro archivo <code>barcelona.html</code> para que el visor de mapas consuma las teselas vectoriales servidas por
 nuestro TileServer:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mapa VT<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css&#39;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://mapbox-gl-inspect.lukasmartinelli.ch/dist/mapbox-gl-inspect.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://mapbox-gl-inspect.lukasmartinelli.ch/dist/mapbox-gl-inspect.min.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="nt">html</span><span class="o">,</span> <span class="nt">body</span> <span class="p">{</span>
            <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;map&#39;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="c1">// id del elemento HTML que contendrá el mapa</span>
<span class="hll">        <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8081/styles/osm-bright/style.json&#39;</span><span class="p">,</span> <span class="c1">// Ubicación del estilo</span>
</span>        <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.175</span><span class="p">,</span> <span class="mf">41.39</span><span class="p">],</span> <span class="c1">// Ubicación inicial</span>
        <span class="nx">zoom</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span> <span class="c1">// Zoom inicial</span>
        <span class="nx">bearing</span><span class="o">:</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="c1">// Ángulo de rotación inicial</span>
        <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span> <span class="c1">// Permite ir guardando la posición del mapa en la URL</span>
    <span class="p">});</span>

    <span class="c1">// Agrega controles de navegación (zoom, rotación) al mapa:</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">NavigationControl</span><span class="p">());</span>

    <span class="c1">// Agregar el control de inspección</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">MapboxInspect</span><span class="p">());</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<h2 id="configuracion-completa">Configuración completa</h2>
<p>Vamos a extraer un primer fichero de configuración. Para ello, debemos parar el servidor <code>tileserver-gl-light</code> y vamos
a arrancarlo de nuevo, pero esta vez con la opción <code>-V</code> (verbose):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>tileserver-gl-light data/barcelona.mbtiles -p <span class="m">8081</span> -V
</pre></div>
</td></tr></table>

<p>Observaremos que nos responde "Automatically creating config file for barcelona.mbtiles", y a continuación nos muestra
el fichero de configuración que ha autogenerado, y que aproximadamente tendrá este aspecto:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;paths&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;root&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/siglibre/.nvm/versions/node/v6.14.2/lib/node_modules/tileserver-gl-light/node_modules/tileserver-gl-styles&quot;</span><span class="p">,</span>
      <span class="nt">&quot;fonts&quot;</span><span class="p">:</span> <span class="s2">&quot;fonts&quot;</span><span class="p">,</span>
      <span class="nt">&quot;styles&quot;</span><span class="p">:</span> <span class="s2">&quot;styles&quot;</span><span class="p">,</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;/home/siglibre/Desktop/taller-vt/tileserver/data&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;styles&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;klokantech-basic&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;klokantech-basic/style.json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tilejson&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">-180</span><span class="p">,</span> <span class="mf">-85.0511</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">85.0511</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;osm-bright&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;osm-bright/style.json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tilejson&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">-180</span><span class="p">,</span> <span class="mf">-85.0511</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mf">85.0511</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;v3&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;barcelona.mbtiles&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>La configuración se divide en estos tres elementos:</p>
<ul>
<li><code>options.paths</code>: Rutas de donde obtener los diferentes recursos: <code>mbtiles</code> (datos), <code>fonts</code> (también llamados <code>glyphs</code>), y <code>styles</code>.</li>
<li><code>styles</code>: Ficheros de estilos y alguna información adicional para generar el fichero auxiliar TileJSON.</li>
<li><code>data</code>: Origenes de datos. Apunta a los diferentes ficheros <code>.mbtiles</code> que queramos servir.</li>
</ul>
<p>Copiemos la configuración que nos ha devuelto <code>tileserver-gl-light -V</code> en un nuevo fichero llamado <code>tileserver/config.json</code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Atención a la ruta de <code>options.paths</code>, que puede variar ligeramente entre estos apuntes y la ruta en vuestra máquina,
dependiendo de la versión exacta de node que tengáis instalada. Tened en cuenta esta discrepancia en la ruta para las
próximas instrucciones. El resto de la configuración debería ser la misma. </p>
</div>
<p>Por defecto <code>Tileserver GL</code> viene con dos estilos incorporados (<code>klokantech-basic</code> y <code>osm-bright</code>) y cuatro tipografías
(<code>Open Sans</code> en sus varintes <code>Regular</code>, <code>Italic</code>, <code>Bold</code> y <code>Semibold</code>), que se esconden en la ruta profunda indicada en
<code>options.paths.root</code>.</p>
<p>Vamos a copiar estos recursos en nuestro directorio de trabajo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nb">cd</span> ~/Desktop/taller-vt/tileserver
cp -r /home/siglibre/.nvm/versions/node/v6.14.2/lib/node_modules/tileserver-gl-light/node_modules/tileserver-gl-styles/styles .
cp -r /home/siglibre/.nvm/versions/node/v6.14.2/lib/node_modules/tileserver-gl-light/node_modules/tileserver-gl-styles/fonts .
</pre></div>
</td></tr></table>

<p>Comprobemos que en <code>~/Desktop/taller-vt/tileserver</code> tenemos tres directorios <code>data</code>, <code>fonts</code> y <code>styles</code>, y el fichero <code>config.json</code>.</p>
<p>Modifiquemos ahora el fichero <code>config.json</code> para apuntar a nuestros recursos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;paths&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">      <span class="nt">&quot;root&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span class="hll">      <span class="nt">&quot;fonts&quot;</span><span class="p">:</span> <span class="s2">&quot;fonts&quot;</span><span class="p">,</span>
</span><span class="hll">      <span class="nt">&quot;styles&quot;</span><span class="p">:</span> <span class="s2">&quot;styles&quot;</span><span class="p">,</span>
</span><span class="hll">      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span>
</span>    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;styles&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;klokantech-basic&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;klokantech-basic/style.json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tilejson&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">        <span class="nt">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.898</span><span class="p">,</span> <span class="mf">41.246</span><span class="p">,</span> <span class="mf">2.312</span><span class="p">,</span> <span class="mf">41.533</span><span class="p">]</span>
</span>      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;osm-bright&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;osm-bright/style.json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tilejson&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">        <span class="nt">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.898</span><span class="p">,</span> <span class="mf">41.246</span><span class="p">,</span> <span class="mf">2.312</span><span class="p">,</span> <span class="mf">41.533</span><span class="p">]</span>
</span>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;v3&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;barcelona.mbtiles&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>De paso hemos modificado el BBOX de los datos de Barcelona, que no estaba bien ajustado.</p>
<p>Ahora paramos y arrancamos tileserver de nuevo, sin más parámetros que el puerto, y leerá automáticamente la
configuración del nuevo fichero <code>config.json</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>tileserver-gl-light -p <span class="m">8081</span>
</pre></div>
</td></tr></table>

<p>Tileserver deberá decir "Using specified config file from config.json". Si vamos a <a href="http://localhost:8081">http://localhost:8081</a> deberíamos
ver lo mismo que antes, pero ahora podremos ir añadiendo y modificando los recursos (datos, estilos, tipografías e iconos)
 que servimos.</p>
<h2 id="anadiendo-datos-de-edificios">Añadiendo datos de edificios</h2>
<p>Vamos a copiar un nuevo <code>.mbtiles</code> con información de edificios:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>cp ../datos/buildings.mbtiles data/
</pre></div>
</td></tr></table>

<p>Y lo vamos a añadir al fichero <code>config.json</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;paths&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;root&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
      <span class="nt">&quot;fonts&quot;</span><span class="p">:</span> <span class="s2">&quot;fonts&quot;</span><span class="p">,</span>
      <span class="nt">&quot;styles&quot;</span><span class="p">:</span> <span class="s2">&quot;styles&quot;</span><span class="p">,</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;styles&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;klokantech-basic&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;klokantech-basic/style.json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tilejson&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.898</span><span class="p">,</span> <span class="mf">41.246</span><span class="p">,</span> <span class="mf">2.312</span><span class="p">,</span> <span class="mf">41.533</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;osm-bright&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;osm-bright/style.json&quot;</span><span class="p">,</span>
      <span class="nt">&quot;tilejson&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;bounds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.898</span><span class="p">,</span> <span class="mf">41.246</span><span class="p">,</span> <span class="mf">2.312</span><span class="p">,</span> <span class="mf">41.533</span><span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;v3&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;barcelona.mbtiles&quot;</span>
    <span class="p">},</span>
<span class="hll">    <span class="nt">&quot;buildings&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="nt">&quot;mbtiles&quot;</span><span class="p">:</span> <span class="s2">&quot;buildings.mbtiles&quot;</span>
</span><span class="hll">    <span class="p">}</span>
</span>  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Paramos el servidor y arrancamos de nuevo. Recargando la página <a href="http://localhost:8081">http://localhost:8081</a> veremos el nuevo dataset:</p>
<p><img alt="Tileserver Buildings Datasource" src="../img/tileserver-buildings-source.png" /></p>
<p>Haciendo click en "Preview":</p>
<p><img alt="Tileserver Buildings Inspect" src="../img/tileserver-buildings-preview.png" /></p>
<p>Efectivamente, se trata de una capa con más de 500.000 construcciones de catastro, con la referencia de la parcela
catastral a la que pertenece cada construcción, y el número de plantas para cada construcción. </p>
<div class="admonition question">
<p class="admonition-title">Question</p>
<p>¿Para qué sirve el "TileJSON" de un dataset?</p>
<p>En última instancia, las teselas vectoriales se sirven en un servicio HTTP con una URL que acaba en <code>/{z}/{x}/{y}.pbf</code>.</p>
<p>De hecho, en el estilo de mapbox podemos indicar esta url directamente, así:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;sources&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="err">...</span>
    <span class="nt">&quot;buildings&quot;</span><span class="p">,</span> <span class="err">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
        <span class="nt">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://localhost:8081/data/buildings/{z}/{x}/{y}.pbf&quot;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="err">}</span>
</pre></div>
</td></tr></table>

<p>Aunque el método preferido es apuntar a un TileJSON. Esta configuración sería equivalente a la anterior, pero más correcta:
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s2">&quot;sources&quot;</span><span class="err">:</span> <span class="p">{</span>
    <span class="err">...</span>
    <span class="nt">&quot;buildings&quot;</span><span class="p">,</span> <span class="err">{</span>
        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
        <span class="nt">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost:8081/data/buildings.json&quot;</span>
    <span class="p">}</span>
<span class="err">}</span>
</pre></div>
</td></tr></table></p>
<p>El fichero TileJSON acaba teniendo una propiedad "tiles" que apunta al servicio XYZ, pero además contiene otros
metadatos útiles para quien consume el dataset. Por ejemplo, el rango de niveles de zoom válidos para el dataset
(<code>minzoom</code>, <code>maxzoom</code>) y el bbox válido (<code>bounds</code>), lo que evita hacer peticiones fuera de rango al servidor, y
otros metadatos como las "capas" contenidas en cada Vector Tile, y los atributos de cada capa. Esto ayuda a funcionar
al <code>InspectorPlugin</code>, y también nos da información a la hora de simbolizar la capa, ya que nos describe el esquema
de los datos.</p>
</div>
<h2 id="anadiendo-los-nuevos-datos-al-visor">Añadiendo los nuevos datos al visor</h2>
<p>Para visualizar los datos de edificios en <code>barcelona.html</code>, usar el siguiente código javascript:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="c1">// id del elemento HTML que contendrá el mapa</span>
<span class="hll">        <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8081/styles/klokantech-basic/style.json&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.19224</span><span class="p">,</span> <span class="mf">41.38585</span><span class="p">],</span>
</span><span class="hll">        <span class="nx">zoom</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">bearing</span><span class="o">:</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span>
</span><span class="hll">        <span class="nx">pitch</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span>
</span>        <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>

<span class="hll">    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class="hll">        <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="p">{</span>
</span><span class="hll">            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://localhost:8081/data/buildings.json&quot;</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">
</span><span class="hll">        <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
</span><span class="hll">            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;source-layer&quot;</span><span class="o">:</span> <span class="s2">&quot;buildingpart&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
</span><span class="hll">                <span class="s2">&quot;fill-opacity&quot;</span><span class="o">:</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span class="hll">                <span class="s2">&quot;fill-color&quot;</span><span class="o">:</span> <span class="s2">&quot;#E9DFCD&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="s2">&quot;fill-outline-color&quot;</span><span class="o">:</span> <span class="s2">&quot;#000&quot;</span>
</span><span class="hll">            <span class="p">}</span>
</span><span class="hll">        <span class="p">});</span>
</span><span class="hll">    <span class="p">});</span>
</span>
    <span class="c1">// Agrega controles de navegación (zoom, rotación) al mapa:</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">NavigationControl</span><span class="p">());</span>

    <span class="c1">// Agregar el control de inspección</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">MapboxInspect</span><span class="p">());</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p><img alt="Buildings 2d" src="../img/buildings-2d.png" /></p>
<p>Incluso podemos usar una regla de simbolización de extrusión para verlos en 3D:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="c1">// id del elemento HTML que contendrá el mapa</span>
        <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8081/styles/klokantech-basic/style.json&#39;</span><span class="p">,</span>
        <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.19224</span><span class="p">,</span> <span class="mf">41.38585</span><span class="p">],</span>
        <span class="nx">zoom</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="nx">bearing</span><span class="o">:</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span>
        <span class="nx">pitch</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>

    <span class="nx">map</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">map</span><span class="p">.</span><span class="nx">addSource</span><span class="p">(</span><span class="s2">&quot;buildings&quot;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;vector&quot;</span><span class="p">,</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://localhost:8081/data/buildings.json&quot;</span>
        <span class="p">});</span>

        <span class="nx">map</span><span class="p">.</span><span class="nx">addLayer</span><span class="p">({</span>
            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;buildings&quot;</span><span class="p">,</span>
            <span class="s2">&quot;source-layer&quot;</span><span class="o">:</span> <span class="s2">&quot;buildingpart&quot;</span><span class="p">,</span>
<span class="hll">            <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;fill-extrusion&quot;</span><span class="p">,</span>
</span>            <span class="s2">&quot;paint&quot;</span><span class="o">:</span> <span class="p">{</span>
<span class="hll">                <span class="s2">&quot;fill-extrusion-opacity&quot;</span><span class="o">:</span> <span class="mf">0.75</span><span class="p">,</span>
</span><span class="hll">                <span class="s2">&quot;fill-extrusion-color&quot;</span><span class="o">:</span> <span class="s2">&quot;#E9DFCD&quot;</span><span class="p">,</span>
</span><span class="hll">                <span class="s2">&quot;fill-extrusion-height&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="s2">&quot;floors&quot;</span><span class="p">]]</span>
</span>            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>

    <span class="c1">// Agrega controles de navegación (zoom, rotación) al mapa:</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">NavigationControl</span><span class="p">());</span>

    <span class="c1">// Agregar el control de inspección</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">MapboxInspect</span><span class="p">());</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>En la regla de simbolización hemos utilizado como altura de la extrusión el número de plantas multiplicado por 3.</p>
<p><img alt="Buildings 3d" src="../img/buildings-3d.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2_visor_simple/" title="2. Cómo visualizarlas" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                2. Cómo visualizarlas
              </span>
            </div>
          </a>
        
        
          <a href="../4_tippecanoe/" title="4. Cómo crearlas" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                4. Cómo crearlas
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.b438e6c5.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>